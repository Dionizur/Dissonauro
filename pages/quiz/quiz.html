<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz dos Dinossauros</title>
    <link rel="stylesheet" href="../../componentes/navbar/navbar.css">
    <link rel="stylesheet" href="quiz.css">
</head>
<body>
    
    <!-- Navbar -->
    <div id="navbar-placeholder"></div>

    <div id="app">
        <div id="loading-state" class="min-h-screen flex items-center justify-center">
            <div class="card w-full max-w-md">
                <div class="card-content p-8 text-center">
                    <div class="animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p class="text-stone-600">Carregando quiz...</p>
                </div>
            </div>
        </div>

        <div id="start-state" class="hidden min-h-screen py-8">
            <div class="max-w-2xl mx-auto px-4">
                <div class="fade-in text-center">
                    <div class="card shadow-2xl border-0 bg-white/80 backdrop-blur">
                        <div class="card-header text-center pb-4">
                            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                                    <path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 0 0 12 21a4 4 0 0 0 7.967-.517 4 4 0 0 0 .556-6.588 4 4 0 0 0-2.526-5.77A3 3 0 1 0 12 5"/>
                                    <path d="M12 5v14"/>
                                    <path d="M7 8h10"/>
                                    <path d="M7 12h10"/>
                                </svg>
                            </div>
                            <h1 class="card-title text-3xl font-bold text-stone-800 mb-2">
                                Quiz dos Dinossauros
                            </h1>
                            <p class="text-stone-600 text-lg">
                                Teste seus conhecimentos sobre o fascinante mundo dos dinossauros
                            </p>
                        </div>
                        
                        <div class="card-content px-8 pb-8">
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-xl p-6">
                                    <h3 class="font-semibold text-stone-800 mb-3">Como funciona:</h3>
                                    <ul class="text-stone-600 space-y-2 text-left">
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-purple-500 rounded-full mr-3"></span>
                                            <span id="questions-count">10</span> perguntas sobre dinossauros
                                        </li>
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full mr-3"></span>
                                            Períodos, dietas e características
                                        </li>
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                            Descubra o quanto você sabe!
                                        </li>
                                    </ul>
                                </div>
                                
                                <button id="start-quiz" class="button button-lg w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white text-lg py-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                        <path d="M12 4v16m8-8H4"/>
                                    </svg>
                                    Começar Quiz
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="quiz-state" class="hidden min-h-screen py-8">
            <div class="max-w-2xl mx-auto px-4">
                <div class="slide-in">
                    <div class="card shadow-2xl border-0 bg-white/80 backdrop-blur">
                        <div class="card-header">
                            <div class="flex justify-between items-center mb-4">
                                <span id="question-number" class="text-sm font-medium text-stone-500">
                                    Pergunta 1 de 10
                                </span>
                                <span id="current-score" class="text-sm font-medium text-stone-500">
                                    Pontuação: 0
                                </span>
                            </div>
                            <div class="progress mb-4">
                                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
                            </div>
                            <h2 id="question-text" class="card-title text-xl font-bold text-stone-800">
                                Carregando pergunta...
                            </h2>
                        </div>
                        
                        <div class="card-content">
                            <div id="options-container" class="space-y-3 mb-6">
                                <!-- As opções serão inseridas aqui via JavaScript -->
                            </div>
                            
                            <button id="next-question" disabled class="button button-lg w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white">
                                Próxima Pergunta
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="result-state" class="hidden min-h-screen py-8">
            <div class="max-w-2xl mx-auto px-4">
                <div class="scale-in text-center">
                    <div class="card shadow-2xl border-0 bg-white/80 backdrop-blur">
                        <div class="card-header text-center pb-4">
                            <div id="trophy-icon" class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                                    <path d="M4 22h16"/>
                                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                                </svg>
                            </div>
                            <h1 class="card-title text-3xl font-bold text-stone-800 mb-2">
                                Quiz Concluído!
                            </h1>
                        </div>
                        
                        <div class="card-content px-8 pb-8">
                            <div class="space-y-6">
                                <div class="text-center">
                                    <div id="final-score" class="text-6xl font-bold mb-2 text-green-600">
                                        0/0
                                    </div>
                                    <div id="percentage" class="text-2xl font-semibold text-stone-800 mb-4">
                                        0% de acertos
                                    </div>
                                    <p id="score-message" class="text-stone-600 text-lg">
                                        Carregando mensagem...
                                    </p>
                                </div>

                                <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-xl p-6">
                                    <h3 class="font-semibold text-stone-800 mb-3">Estatísticas:</h3>
                                    <div class="grid grid-cols-2 gap-4 text-center">
                                        <div>
                                            <div class="text-2xl font-bold text-green-600 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                                </svg>
                                                <span id="correct-answers">0</span>
                                            </div>
                                            <div class="text-sm text-stone-600">Corretas</div>
                                        </div>
                                        <div>
                                            <div class="text-2xl font-bold text-red-600 flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <path d="m15 9-6 6"/>
                                                    <path d="m9 9 6 6"/>
                                                </svg>
                                                <span id="incorrect-answers">0</span>
                                            </div>
                                            <div class="text-sm text-stone-600">Incorretas</div>
                                        </div>
                                    </div>
                                </div>

                                <button id="restart-quiz" class="button button-lg w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white text-lg py-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                        <path d="M3 3v5h5"/>
                                    </svg>
                                    Fazer Novamente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados de exemplo para os dinossauros
        const dinosaurData = [
            {
                id: 1,
                name: "Tiranossauro Rex",
                period: "Cretáceo",
                diet: "Carnívoro",
                interesting_facts: ["ter braços muito pequenos em relação ao corpo", "ser um dos maiores carnívoros terrestres"]
            },
            {
                id: 2,
                name: "Tricerátops",
                period: "Cretáceo",
                diet: "Herbívoro",
                interesting_facts: ["ter três chifres na face", "ser um dinossauro blindado"]
            },
            {
                id: 3,
                name: "Velociraptor",
                period: "Cretáceo",
                diet: "Carnívoro",
                interesting_facts: ["ser menor do que mostram nos filmes", "ser um caçador inteligente em bandos"]
            },
            {
                id: 4,
                name: "Brontossauro",
                period: "Jurássico",
                diet: "Herbívoro",
                interesting_facts: ["ter um pescoço muito longo", "ser um dos maiores dinossauros"]
            },
            {
                id: 5,
                name: "Estegossauro",
                period: "Jurássico",
                diet: "Herbívoro",
                interesting_facts: ["ter placas ósseas nas costas", "usar espinhos na cauda como defesa"]
            },
            {
                id: 6,
                name: "Pterodáctilo",
                period: "Jurássico",
                diet: "Carnívoro",
                interesting_facts: ["não ser realmente um dinossauro, mas um réptil voador", "ter uma envergadura de asas impressionante"]
            },
            {
                id: 7,
                name: "Anquilossauro",
                period: "Cretáceo",
                diet: "Herbívoro",
                interesting_facts: ["ser um tanque blindado vivo", "ter uma clava óssea na cauda"]
            },
            {
                id: 8,
                name: "Espinossauro",
                period: "Cretáceo",
                diet: "Carnívoro",
                interesting_facts: ["ser maior que o Tiranossauro Rex", "provavelmente se alimentar de peixes"]
            },
            {
                id: 9,
                name: "Pteranodon",
                period: "Cretáceo",
                diet: "Carnívoro",
                interesting_facts: ["ter uma crista óssea na cabeça", "não ser um dinossauro, mas um réptil voador"]
            },
            {
                id: 10,
                name: "Diplodoco",
                period: "Jurássico",
                diet: "Herbívoro",
                interesting_facts: ["ter um pescoço extremamente longo", "ser um dos dinossauros mais longos"]
            }
        ];

        // Estado da aplicação
        let state = {
            dinosaurs: [],
            currentQuestion: 0,
            score: 0,
            selectedAnswer: null,
            showResult: false,
            quizStarted: false,
            questions: [],
            isLoading: true
        };

        // Elementos DOM
        const loadingState = document.getElementById('loading-state');
        const startState = document.getElementById('start-state');
        const quizState = document.getElementById('quiz-state');
        const resultState = document.getElementById('result-state');
        const startQuizBtn = document.getElementById('start-quiz');
        const nextQuestionBtn = document.getElementById('next-question');
        const restartQuizBtn = document.getElementById('restart-quiz');
        const questionNumber = document.getElementById('question-number');
        const currentScore = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const questionsCount = document.getElementById('questions-count');
        const finalScore = document.getElementById('final-score');
        const percentage = document.getElementById('percentage');
        const scoreMessage = document.getElementById('score-message');
        const correctAnswers = document.getElementById('correct-answers');
        const incorrectAnswers = document.getElementById('incorrect-answers');
        const trophyIcon = document.getElementById('trophy-icon');

        // Funções
        function generateQuestions(dinos) {
            if (dinos.length < 4) return;

            const questionTypes = [
                { type: 'period', template: 'Em que período viveu o {}?' },
                { type: 'diet', template: 'Qual era a dieta do {}?' },
                { type: 'name', template: 'Qual é o nome deste dinossauro conhecido por {}?' }
            ];

            const generatedQuestions = [];

            // Gerar 10 questões
            for (let i = 0; i < Math.min(10, dinos.length); i++) {
                const questionType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                const correctDino = dinos[i];
                
                let question, correctAnswer, options;

                switch (questionType.type) {
                    case 'period':
                        question = `Em que período viveu o ${correctDino.name}?`;
                        correctAnswer = correctDino.period;
                        options = [...new Set([correctAnswer, 'Triássico', 'Jurássico', 'Cretáceo'])];
                        break;
                    
                    case 'diet':
                        question = `Qual era a dieta do ${correctDino.name}?`;
                        correctAnswer = correctDino.diet;
                        options = [...new Set([correctAnswer, 'Carnívoro', 'Herbívoro', 'Onívoro'])];
                        break;
                    
                    case 'name':
                        const hint = correctDino.interesting_facts?.[0] || `ser do período ${correctDino.period}`;
                        question = `Qual dinossauro é conhecido por ${hint.toLowerCase()}?`;
                        correctAnswer = correctDino.name;
                        const otherDinos = dinos.filter(d => d.id !== correctDino.id).slice(0, 3);
                        options = [correctAnswer, ...otherDinos.map(d => d.name)];
                        break;
                        
                    default:
                        continue;
                }

                // Embaralhar opções
                options = options.slice(0, 4).sort(() => Math.random() - 0.5);
                
                generatedQuestions.push({
                    question,
                    options,
                    correctAnswer,
                    dinosaur: correctDino
                });
            }

            return generatedQuestions;
        }

        function loadDinosaurs() {
            state.isLoading = true;
            // Simular carregamento assíncrono
            setTimeout(() => {
                state.dinosaurs = dinosaurData;
                state.questions = generateQuestions(dinosaurData);
                questionsCount.textContent = state.questions.length;
                state.isLoading = false;
                showStartScreen();
            }, 1500);
        }

        function showStartScreen() {
            loadingState.classList.add('hidden');
            startState.classList.remove('hidden');
            quizState.classList.add('hidden');
            resultState.classList.add('hidden');
        }

        function showQuizScreen() {
            loadingState.classList.add('hidden');
            startState.classList.add('hidden');
            quizState.classList.remove('hidden');
            resultState.classList.add('hidden');
            
            renderQuestion();
        }

        function showResultScreen() {
            loadingState.classList.add('hidden');
            startState.classList.add('hidden');
            quizState.classList.add('hidden');
            resultState.classList.remove('hidden');
            
            renderResults();
        }

        function renderQuestion() {
            const currentQ = state.questions[state.currentQuestion];
            
            questionNumber.textContent = `Pergunta ${state.currentQuestion + 1} de ${state.questions.length}`;
            currentScore.textContent = `Pontuação: ${state.score}`;
            progressBar.style.width = `${(state.currentQuestion / state.questions.length) * 100}%`;
            questionText.textContent = currentQ.question;
            
            // Limpar opções anteriores
            optionsContainer.innerHTML = '';
            
            // Adicionar novas opções
            currentQ.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = `option-button w-full p-4 text-left rounded-lg border-2 ${
                    state.selectedAnswer === option
                        ? 'border-purple-500 bg-purple-50 text-purple-700'
                        : 'border-stone-200 hover:border-stone-300 text-stone-700'
                }`;
                optionButton.innerHTML = `<span class="font-medium">${String.fromCharCode(65 + index)}.</span> ${option}`;
                
                optionButton.addEventListener('click', () => {
                    // Remover seleção anterior
                    document.querySelectorAll('.option-button').forEach(btn => {
                        btn.classList.remove('border-purple-500', 'bg-purple-50', 'text-purple-700');
                        btn.classList.add('border-stone-200', 'text-stone-700');
                    });
                    
                    // Aplicar seleção atual
                    optionButton.classList.add('border-purple-500', 'bg-purple-50', 'text-purple-700');
                    optionButton.classList.remove('border-stone-200', 'text-stone-700');
                    
                    state.selectedAnswer = option;
                    nextQuestionBtn.disabled = false;
                });
                
                optionsContainer.appendChild(optionButton);
            });
            
            // Atualizar texto do botão
            nextQuestionBtn.textContent = state.currentQuestion + 1 === state.questions.length 
                ? 'Ver Resultado' 
                : 'Próxima Pergunta';
                
            nextQuestionBtn.disabled = state.selectedAnswer === null;
            
            // Aplicar animação
            const slideInElement = document.querySelector('#quiz-state .slide-in');
            slideInElement.classList.remove('active');
            setTimeout(() => {
                slideInElement.classList.add('active');
            }, 10);
        }

        function renderResults() {
            const scorePercentage = Math.round((state.score / state.questions.length) * 100);
            
            finalScore.textContent = `${state.score}/${state.questions.length}`;
            percentage.textContent = `${scorePercentage}% de acertos`;
            scoreMessage.textContent = getScoreMessage(scorePercentage);
            correctAnswers.textContent = state.score;
            incorrectAnswers.textContent = state.questions.length - state.score;
            
            // Atualizar cor do troféu com base na pontuação
            if (scorePercentage >= 80) {
                trophyIcon.className = 'w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center';
                finalScore.className = 'text-6xl font-bold mb-2 text-green-600';
            } else if (scorePercentage >= 60) {
                trophyIcon.className = 'w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-amber-400 to-amber-600 rounded-full flex items-center justify-center';
                finalScore.className = 'text-6xl font-bold mb-2 text-amber-600';
            } else {
                trophyIcon.className = 'w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-red-400 to-red-600 rounded-full flex items-center justify-center';
                finalScore.className = 'text-6xl font-bold mb-2 text-red-600';
            }
            
            // Aplicar animação
            const scaleInElement = document.querySelector('#result-state .scale-in');
            scaleInElement.classList.remove('active');
            setTimeout(() => {
                scaleInElement.classList.add('active');
            }, 10);
        }

        function getScoreMessage(percentage) {
            if (percentage >= 80) return "Excelente! Você é um verdadeiro especialista em dinossauros! 🦕";
            if (percentage >= 60) return "Muito bom! Você tem um bom conhecimento sobre dinossauros! 👏";
            if (percentage >= 40) return "Não está mal! Continue estudando sobre dinossauros! 📚";
            return "Continue explorando o mundo dos dinossauros para aprender mais! 🔍";
        }

        function startQuiz() {
            state.quizStarted = true;
            state.currentQuestion = 0;
            state.score = 0;
            state.selectedAnswer = null;
            state.showResult = false;
            
            showQuizScreen();
        }

        function handleNextQuestion() {
            if (state.selectedAnswer === state.questions[state.currentQuestion].correctAnswer) {
                state.score++;
            }

            if (state.currentQuestion + 1 < state.questions.length) {
                state.currentQuestion++;
                state.selectedAnswer = null;
                renderQuestion();
            } else {
                state.showResult = true;
                showResultScreen();
            }
        }

        function resetQuiz() {
            state.quizStarted = false;
            state.currentQuestion = 0;
            state.score = 0;
            state.selectedAnswer = null;
            state.showResult = false;
            
            showStartScreen();
        }

        // Event Listeners
        startQuizBtn.addEventListener('click', startQuiz);
        nextQuestionBtn.addEventListener('click', handleNextQuestion);
        restartQuizBtn.addEventListener('click', resetQuiz);

        // Inicializar a aplicação
        window.addEventListener('DOMContentLoaded', () => {
            // Aplicar animação de entrada na tela inicial
            const fadeInElement = document.querySelector('.fade-in');
            setTimeout(() => {
                fadeInElement.classList.add('active');
            }, 100);
            
            loadDinosaurs();
        });
    </script>
    <script src="../../supabase.js"></script>
    <script src="../../componentes/navbar/navbar.js"></script>
</body>
</html>
